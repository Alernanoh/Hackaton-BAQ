<div class="donation-container">
  <div class="form-section">

    <!-- Información del donante -->
    <div class="info-donante">
      <h3>Información del donante</h3>
      <div class="anonimo-checkbox">
        <input type="checkbox" [(ngModel)]="donacionAnonima" />
        <label>Donar anónimamente</label>
      </div>

      <ng-container *ngIf="!donacionAnonima">
        <!-- Tipo de donante -->
        <div class="input-group">
          <label>Tipo de donante</label>
          <select [(ngModel)]="tipoDonante" (change)="cambiarTipoDonante(tipoDonante)">
            <option value="extranjero">Extranjero</option>
            <option value="ecuatoriano">Ecuatoriano</option>
          </select>
        </div>

        <!-- Donante ecuatoriano -->
        <div *ngIf="tipoDonante === 'ecuatoriano'" class="card-identificacion">
          <div class="input-group">
            <label>Tipo de identificación</label>
            <div class="radio-group">
              <label>
                <input type="radio" [(ngModel)]="tipoIdentificacion" value="cedula" /> Cédula
              </label>
              <label>
                <input type="radio" [(ngModel)]="tipoIdentificacion" value="ruc" /> RUC
              </label>
            </div>
          </div>

          <div class="input-group">
            <label>Número</label>
            <input
              type="text"
              [(ngModel)]="numeroIdentificacion"
              placeholder="Ingrese número de identificación"
              [disabled]="validado || cargando"
            />
          </div>

          <div class="form-actions validate-actions">
            <div *ngIf="cargando" class="progressbar">
              <div class="progressbar-bar"></div>
              <span>Validando identificación...</span>
            </div>
            <button
              *ngIf="!validado"
              class="btn-orange"
              [class.disabled]="cargando"
              (click)="validarIdentificacion()"
              [disabled]="cargando"
            >
              Validar
            </button>
          </div>

          <!-- Datos validados -->
          <div *ngIf="validado" class="inputs-grid">
            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Nombres *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Razón Social *</label>
              <input type="text" [value]="datosValidados.nombre" disabled />
            </div>

            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Apellidos *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Nombre Comercial</label>
              <input type="text" [value]="datosValidados.apellido" disabled />
            </div>

            <div class="input-group">
              <label>Correo electrónico *</label>
              <input
                type="email"
                [(ngModel)]="datosValidados.correo"
                placeholder="Ingresa tu correo electrónico"
                [class.warning]="!datosValidados.correo"
              />
              <small *ngIf="!datosValidados.correo" class="helper-text">
                Completa este campo para poder contactarte
              </small>
            </div>

            <div class="input-group">
              <label>Teléfono</label>
              <input
                type="tel"
                [(ngModel)]="datosValidados.telefono"
                placeholder="Ingresa tu número de teléfono"
                [class.warning]="!datosValidados.telefono"
              />
              <small *ngIf="!datosValidados.telefono" class="helper-text">
                Este campo es opcional, pero recomendado
              </small>
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.actividad">
              <label>Actividad Económica</label>
              <input type="text" [value]="datosValidados.actividad" disabled />
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.estado">
              <label>Estado del contribuyente</label>
              <input type="text" [value]="datosValidados.estado" disabled />
            </div>

            <div class="form-actions full-width">
              <button class="btn-reset" type="button" (click)="volverAEmpezar()">
                🔁 Volver a empezar
              </button>
            </div>
          </div>
        </div>

        <!-- Donante extranjero -->
        <div *ngIf="tipoDonante === 'extranjero'">
          <div class="inputs">
            <div class="input-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="extranjeroNombre" placeholder="Nombre *" />
            </div>
            <div class="input-group">
              <label>Apellido *</label>
              <input type="text" [(ngModel)]="extranjeroApellido" placeholder="Apellido *" />
            </div>
            <div class="input-group">
              <label>Correo electrónico *</label>
              <input type="email" [(ngModel)]="extranjeroCorreo" placeholder="Correo electrónico *" />
            </div>
            <div class="input-group">
              <label>Teléfono</label>
              <input type="tel" [(ngModel)]="extranjeroTelefono" placeholder="Teléfono" />
            </div>
          </div>
        </div>
      </ng-container>

      <div *ngIf="donacionAnonima" class="anonimo-msg">
        <p>Tu donación se realizará de manera anónima. ¡Gracias por tu generosidad! 💛</p>
      </div>
    </div>

    <!-- ¿Cuánto quieres donar? -->
    <h2>¿Cuánto quieres donar?</h2>
    <div class="amount-options">
      <button (click)="selectAmount(12)" [class.active]="selectedAmount === 12">$12</button>
      <button (click)="selectAmount(22)" [class.active]="selectedAmount === 22">$22</button>
      <button (click)="selectAmount(36)" [class.active]="selectedAmount === 36">$36</button>
      <button (click)="selectAmount(100)" [class.active]="selectedAmount === 100">$100</button>
    </div>
    <div class="amount-input-container" style="display: flex; gap: 0.5rem; align-items: center;">
      <input
        type="number"
        [(ngModel)]="customAmount"
        placeholder="$ Monto personalizado"
        class="amount-input"
        [class.error]="showAmountError"
        min="2"
        style="flex: 1;"
      />
      <button type="button" class="btn-orange" (click)="confirmarMonto()">Donar</button>
    </div>
    <div *ngIf="showAmountError" class="error-message">
      El monto mínimo de donación es $2
    </div>

    <!-- Campo opcional de dedicatoria -->
    <div class="input-group" style="margin-top: 1rem;">
      <label>
        <span style="color: #f7941d; font-size: 1.2em;">&#10084;&#65039;</span>
        ¿Quieres dedicar tu donación? (opcional)
      </label>
      <input
        type="text"
        [(ngModel)]="dedicatoria"
        maxlength="120"
        placeholder="Ej: En memoria de mi abuela, por los niños, por amor, etc."
        style="font-style: italic;"
      />
      <small class="helper-text">Puedes dedicar tu donación a alguien especial o escribir tu intención 💛</small>
    </div>

    <!-- Botón de PayPal solo si corresponde -->
    <div *ngIf="mostrarBotonPaypal" class="paypal-button-container">
      <div #paypalContainer></div>
    </div>
  </div>
</div>
