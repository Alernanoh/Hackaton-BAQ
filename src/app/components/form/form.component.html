<div class="donation-container">
  <div class="form-section">

    <!-- Información del donante -->
    <div class="info-donante">
       <div class="anonimo-switch">
        <label class="switch">
          <input type="checkbox" [(ngModel)]="donacionAnonima" />
          <span class="slider"></span>
        </label>
        <span class="anonimo-label" [class.active]="donacionAnonima">
          Donar anónimamente
        </span>
      </div>

      <ng-container *ngIf="!donacionAnonima">
        <!-- Tipo de donante -->
        <div class="input-group">
          <label>Tipo de donante</label>
          <select [(ngModel)]="tipoDonante" (change)="cambiarTipoDonante(tipoDonante)">
            <option value="extranjero">Extranjero</option>
            <option value="ecuatoriano">Ecuatoriano</option>
          </select>
        </div>

        <!-- Donante ecuatoriano -->
        <div *ngIf="tipoDonante === 'ecuatoriano'" class="card-identificacion">
          <div class="input-group">
            <label>Tipo de identificación</label>
            <div class="toggle-identificacion">
              <span [class.selected]="tipoIdentificacion === 'cedula'">Cédula</span>
              <label class="switch-identificacion">
                <input
                  type="checkbox"
                  [checked]="tipoIdentificacion === 'ruc'"
                  (change)="tipoIdentificacion = tipoIdentificacion === 'cedula' ? 'ruc' : 'cedula'"
                />
                <span class="slider-identificacion"></span>
              </label>
              <span [class.selected]="tipoIdentificacion === 'ruc'">RUC</span>
            </div>
          </div>

          <div class="input-group">
            <label>Número</label>
            <input
              type="text"
              [(ngModel)]="numeroIdentificacion"
              placeholder="Ingrese número de identificación"
              [disabled]="validado || cargando"
            />
          </div>

          <div class="form-actions validate-actions">
            <div *ngIf="cargando" class="progressbar">
              <div class="progressbar-bar"></div>
              <span>Validando identificación...</span>
            </div>
            <button
              *ngIf="!validado"
              class="btn-orange"
              [class.disabled]="cargando"
              (click)="validarIdentificacion()"
              [disabled]="cargando"
            >
              Validar
            </button>
          </div>

          <!-- Datos validados -->
          <div *ngIf="validado" class="inputs-grid">
            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Nombres *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Razón Social *</label>
              <input type="text" [value]="datosValidados.nombre" disabled />
            </div>

            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Apellidos *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Nombre Comercial</label>
              <input type="text" [value]="datosValidados.apellido" disabled />
            </div>

            <div class="input-group">
              <label>Correo electrónico *</label>
              <input
                type="email"
                [(ngModel)]="datosValidados.correo"
                placeholder="Ingresa tu correo electrónico"
                [class.warning]="!datosValidados.correo"
              />
              <small *ngIf="!datosValidados.correo" class="helper-text">
                Completa este campo para poder contactarte
              </small>
            </div>

            <div class="input-group">
              <label>Teléfono</label>
              <input
                type="tel"
                [(ngModel)]="datosValidados.telefono"
                placeholder="Ingresa tu número de teléfono"
                [class.warning]="!datosValidados.telefono"
              />
              <small *ngIf="!datosValidados.telefono" class="helper-text">
                Este campo es opcional, pero recomendado
              </small>
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.actividad">
              <label>Actividad Económica</label>
              <input type="text" [value]="datosValidados.actividad" disabled />
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.estado">
              <label>Estado del contribuyente</label>
              <input type="text" [value]="datosValidados.estado" disabled />
            </div>

            <div class="form-actions full-width">
              <button class="btn-reset-rojo" type="button" (click)="volverAEmpezar()">
                Volver a empezar
              </button>
              <button class="btn-pdf-verde" (click)="generarPDF()">Descargar Resumen PDF</button>
            </div>
          </div>
        </div>

        <!-- Donante extranjero -->
        <div *ngIf="tipoDonante === 'extranjero'">
          <div class="inputs">
            <div class="input-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="extranjeroNombre" placeholder="Nombre *" />
            </div>
            <div class="input-group">
              <label>Apellido *</label>
              <input type="text" [(ngModel)]="extranjeroApellido" placeholder="Apellido *" />
            </div>
            <div class="input-group">
              <label>Correo electrónico *</label>
              <input type="email" [(ngModel)]="extranjeroCorreo" placeholder="Correo electrónico *" />
            </div>
            <div class="input-group">
              <label>Teléfono</label>
              <input type="tel" [(ngModel)]="extranjeroTelefono" placeholder="Teléfono" />
            </div>
          </div>
        </div>
      </ng-container>

  <div *ngIf="donacionAnonima" class="anonimo-msg">
  <p><em>Tu donación se realizará de manera anónima. ¡Gracias por tu apoyo!</em></p>
</div>


    <!-- ¿Cuánto quieres donar? -->
    <div *ngIf="!modoCarrito">
      <h2 style="display: flex; align-items: center; gap: 0.5rem;">
        ¿Cuánto quieres donar?
      </h2>
      <div class="amount-options">
        <button (click)="selectAmount(5)" [class.active]="selectedAmount === 5">$5</button>
        <button (click)="selectAmount(10)" [class.active]="selectedAmount === 10">$10</button>
        <button (click)="selectAmount(20)" [class.active]="selectedAmount === 20">$20</button>
        <button (click)="selectAmount(100)" [class.active]="selectedAmount === 100">$100</button>
      </div>
      <!-- Switch de donación recurrente debajo de los valores predefinidos -->
      <div style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0;">
        <label class="switch" style="margin-bottom: 0; transform: scale(0.7);">
          <input type="checkbox" [(ngModel)]="donacionRecurrente" />
          <span class="slider"></span>
        </label>
        <span style="font-size: 0.85em;">Activar donación mensual</span>
      </div>
      <div class="amount-input-container" style="display: flex; gap: 0.5rem; align-items: center;">
        <input
          type="number"
          [(ngModel)]="customAmount"
          placeholder="$ Monto personalizado"
          class="amount-input"
          [class.error]="showAmountError"
          min="2"
          style="flex: 1;"
        />
        <button type="button" class="btn-orange btn-donar-grande" (click)="confirmarMonto()">Donar</button>
      </div>
      <div *ngIf="showAmountError" class="error-message">
        El monto mínimo de donación es $2
      </div>
    </div>

    <!-- Campo opcional de dedicatoria -->
    <div class="input-group" style="margin-top: 1rem;">
      <label>
        <span style="color: #f7941d; font-size: 1.2em;">&#10084;&#65039;</span>
        ¿Quieres dedicar tu donación? (opcional)
      </label>
      <input
        type="text"
        [(ngModel)]="dedicatoria"
        maxlength="120"
        placeholder="Ej: En memoria de mi abuela, por los niños, por amor, etc."
        style="font-style: italic;"
      />
      <small class="helper-text">Puedes dedicar tu donación a alguien especial o escribir tu intención 💛</small>
    </div>

    <!-- Botón de PayPal solo si corresponde -->
    <div *ngIf="mostrarBotonPaypal" class="paypal-button-container">
      <div #paypalContainer></div>
    </div>

    <!-- Botón de donar en modo carrito -->
    <div *ngIf="modoCarrito" style="text-align:center; margin-top:1.5rem;">
      <button type="button" class="btn-orange btn-donar-grande" (click)="confirmarMonto()">Donar</button>
    </div>

    <div class="info-validacion" style="white-space: normal; word-break: break-word; max-width: 100%;">
      <!-- Mensaje de validación -->
    </div>
  </div>
</div>
