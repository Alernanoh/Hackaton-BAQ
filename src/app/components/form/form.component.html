<div class="donation-container">
  <div class="form-section">
    <h2>¿Cuánto quieres donar?</h2>

    <!-- Opciones de monto -->
    <div class="amount-options">
      <button (click)="selectAmount(12)" [class.active]="selectedAmount === 12">$12</button>
      <button (click)="selectAmount(22)" [class.active]="selectedAmount === 22">$22</button>
      <button (click)="selectAmount(36)" [class.active]="selectedAmount === 36">$36</button>
      <button (click)="selectAmount(100)" [class.active]="selectedAmount === 100">$100</button>
    </div>

    <!-- Monto personalizado -->
    <div class="amount-input-container">
      <input
        type="number"
        [(ngModel)]="customAmount"
        (blur)="validateAmount()"
        placeholder="$ Monto personalizado"
        class="amount-input"
        [class.error]="showAmountError"
        min="2"
      />
      <div *ngIf="showAmountError" class="error-message">
        El monto mínimo de donación es $2
      </div>
    </div>

    <!-- Información del donante -->
    <div class="info-donante">
      <h3>Información del donante</h3>

      <!-- Checkbox de donación anónima (siempre visible) -->
      <div class="anonimo-checkbox">
        <input type="checkbox" [(ngModel)]="donacionAnonima" />
        <label>Donar anónimamente</label>
      </div>

      <!-- Si NO es anónima, mostrar campos -->
      <ng-container *ngIf="!donacionAnonima">
        <!-- Tipo de donante -->
        <div class="input-group">
          <label>Tipo de donante</label>
          <select [(ngModel)]="tipoDonante" (change)="cambiarTipoDonante(tipoDonante)">
            <option value="extranjero">Extranjero</option>
            <option value="ecuatoriano">Ecuatoriano</option>
          </select>
        </div>

        <!-- Donante ecuatoriano -->
        <div *ngIf="tipoDonante === 'ecuatoriano'" class="card-identificacion">
          <div class="input-group">
            <label>Tipo de identificación</label>
            <div class="radio-group">
              <label>
                <input type="radio" [(ngModel)]="tipoIdentificacion" value="cedula" /> Cédula
              </label>
              <label>
                <input type="radio" [(ngModel)]="tipoIdentificacion" value="ruc" /> RUC
              </label>
            </div>
          </div>

          <div class="input-group">
            <label>Número</label>
            <input
              type="text"
              [(ngModel)]="numeroIdentificacion"
              placeholder="Ingrese número de identificación"
              [disabled]="validado || cargando"
            />
          </div>

          <div class="form-actions validate-actions">
            <div *ngIf="cargando" class="progressbar">
              <div class="progressbar-bar"></div>
              <span>Validando identificación...</span>
            </div>
            <button
              *ngIf="!validado"
              class="btn-orange"
              [class.disabled]="cargando"
              (click)="validarIdentificacion()"
              [disabled]="cargando"
            >
              Validar
            </button>
          </div>

          <!-- Datos validados -->
          <div *ngIf="validado" class="inputs-grid">
            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Nombres *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Razón Social *</label>
              <input type="text" [value]="datosValidados.nombre" disabled />
            </div>

            <div class="input-group">
              <label *ngIf="tipoIdentificacion === 'cedula'">Apellidos *</label>
              <label *ngIf="tipoIdentificacion === 'ruc'">Nombre Comercial</label>
              <input type="text" [value]="datosValidados.apellido" disabled />
            </div>

            <div class="input-group">
              <label>Correo electrónico *</label>
              <input
                type="email"
                [(ngModel)]="datosValidados.correo"
                placeholder="Ingresa tu correo electrónico"
                [class.warning]="!datosValidados.correo"
              />
              <small *ngIf="!datosValidados.correo" class="helper-text">
                Completa este campo para poder contactarte
              </small>
            </div>

            <div class="input-group">
              <label>Teléfono</label>
              <input
                type="tel"
                [(ngModel)]="datosValidados.telefono"
                placeholder="Ingresa tu número de teléfono"
                [class.warning]="!datosValidados.telefono"
              />
              <small *ngIf="!datosValidados.telefono" class="helper-text">
                Este campo es opcional, pero recomendado
              </small>
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.actividad">
              <label>Actividad Económica</label>
              <input type="text" [value]="datosValidados.actividad" disabled />
            </div>

            <div class="input-group full-width" *ngIf="datosValidados.estado">
              <label>Estado del contribuyente</label>
              <input type="text" [value]="datosValidados.estado" disabled />
            </div>

            <div class="form-actions full-width">
              <button class="btn-reset" type="button" (click)="volverAEmpezar()">
                🔁 Volver a empezar
              </button>
            </div>
          </div>
        </div>

        <!-- Donante extranjero -->
        <div *ngIf="tipoDonante === 'extranjero'">
          <div class="inputs">
            <div class="input-group">
              <label>Nombre *</label>
              <input type="text" placeholder="Nombre *" />
            </div>
            <div class="input-group">
              <label>Apellido *</label>
              <input type="text" placeholder="Apellido *" />
            </div>
            <div class="input-group">
              <label>Correo electrónico *</label>
              <input type="email" placeholder="Correo electrónico *" />
            </div>
            <div class="input-group">
              <label>Teléfono</label>
              <input type="tel" placeholder="Teléfono" />
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Si ES donación anónima -->
      <div *ngIf="donacionAnonima" class="anonimo-msg">
        <p>Tu donación se realizará de manera anónima. ¡Gracias por tu generosidad! 💛</p>
      </div>
    </div>

    <!-- Botones de pago al final -->
    <div class="payment-shortcuts">
      <button class="btn-payphone" (click)="pagarConPayPhone()">PayPhone</button>
      <button class="btn-paypal" (click)="mostrarPaypal()">PayPal</button>
    </div>

    <div *ngIf="mostrarBotonPaypal" class="paypal-button-container">
      <div #paypalContainer></div>
    </div>
  </div>
</div>
